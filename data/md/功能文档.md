# Finance Agent Chat - 功能文档

## 项目概述

**项目名称**: Finance Agent Chat  
**项目类型**: AI 智能助手聊天应用  
**前端技术栈**: Vue 3 + Vite  
**版本**: 0.0.0  

---

## 目录

- [项目概述](#项目概述)
- [核心功能](#核心功能)
- [用户界面](#用户界面)
- [技术架构](#技术架构)
- [API 接口](#api-接口)
- [配置说明](#配置说明)

---

## 核心功能

### 1. AI 智能对话

#### 功能特性
- **实时流式响应**: 使用 Server-Sent Events (SSE) 技术实现实时消息流
- **Markdown 渲染**: 支持富文本消息展示，包括代码块、列表、表格等
- **推理过程展示**: 显示 AI 的推理步骤和思维过程
- **工具调用展示**: 展示 AI 使用的工具和调用结果

#### 消息类型
- 普通文本消息
- 代码块（支持语法高亮）
- 推理内容（thinking）
- 工具调用结果

#### 交互功能
- 发送消息（支持 Enter 快捷键，Shift+Enter 换行）
- 复制消息内容
- 点赞 / 点踩反馈
- 停止生成
- 清空对话

### 2. 用户认证系统

#### 登录功能
- 邮箱/密码登录
- JWT Token 认证
- 本地存储持久化
- 自动登录状态恢复

#### 注册功能
- 新用户注册
- 邮箱格式验证
- 密码安全要求

#### 用户管理
- 显示用户邮箱
- 显示注册天数
- 退出登录
- 登录状态持久化

### 3. 对话管理

#### 新建对话
- 点击新建对话按钮创建空白对话
- 自动生成对话 ID
- URL 自动更新以保存对话状态

#### 历史对话
- 侧边栏展示历史对话列表
- 按时间倒序排列
- 显示对话创建时间
- 支持点击加载历史对话

#### 删除对话
- 支持删除单条历史对话
- 二次确认机制
- 删除后自动切换到新对话或最新历史对话

### 4. 对话加载

#### URL 参数支持
- 通过 `?conversation=<id>` 参数分享特定对话
- 页面加载时自动识别 URL 中的对话 ID
- 自动加载对应的历史消息

---

## 用户界面

### 主界面布局

```
┌─────────────────────────────────────────────────────┐
│  Finance Agent Chat                      [用户菜单] │
├──────────┬──────────────────────────────────────────┤
│          │                                          │
│  历史    │           聊天消息区域                    │
│  对话    │                                          │
│  列表    │  ┌────────────────────────────────────┐  │
│          │  │ 用户消息                            │  │
│  [新建]  │  └────────────────────────────────────┘  │
│  对话    │  ┌────────────────────────────────────┐  │
│          │  │ AI 消息                             │  │
│          │  │ 推理过程...                         │  │
│          │  │ 回答内容...                         │  │
│          │  │ [复制] [👍] [👎]                    │  │
│          │  └────────────────────────────────────┘  │
│          │                                          │
├──────────┴──────────────────────────────────────────┤
│  [输入框                                    ] [发送] │
└─────────────────────────────────────────────────────┘
```

### 界面组件

| 组件名称 | 文件路径 | 功能描述 |
|---------|----------|----------|
| **App.vue** | `src/App.vue` | 主应用组件，包含完整聊天界面、侧边栏、消息展示、输入框 |
| **AuthModal** | `src/components/AuthModal.vue` | 登录/注册弹窗组件，支持邮箱密码验证、切换登录/注册模式 |
| **UserMenu** | `src/components/UserMenu.vue` | 用户菜单组件，显示用户信息、注册天数、退出登录按钮 |
| **ConversationHistory** | `src/components/ConversationHistory.vue` | 历史对话侧边栏，支持加载和删除历史记录 |
| **HelloWorld** | `src/components/HelloWorld.vue` | 示例组件（默认生成） |

### 样式设计

#### 设计语言
- **现代简约风格**: ChatGPT 风格的聊天界面
- **暗色主题**: 深色背景配合明亮的强调色
- **圆润边角**: 统一的圆角设计
- **流畅动画**: fadeUp、pulse 等动画效果

#### 颜色方案
- 主背景色: `#0f0f0f`
- 侧边栏背景: `#171717`
- 用户消息背景: `#2563eb`（蓝色）
- AI 消息背景: `#262626`
- 强调色: `#2563eb`

#### 响应式设计
- 桌面端: 侧边栏固定显示
- 移动端: 侧边栏可折叠，通过汉堡菜单切换
- 自适应消息宽度
- 触摸友好的按钮尺寸

---

## 技术架构

### 前端技术栈

| 技术 | 版本 | 用途 |
|------|------|------|
| Vue | 3.5.24 | 前端框架 |
| Vite | 5.4.10 | 构建工具 |
| markdown-it | 14.1.0 | Markdown 解析 |
| vue3-markdown-it | 1.0.10 | Vue Markdown 组件 |

### 项目结构

```
finance-agent-frontend/
├── index.html              # 入口 HTML 文件
├── package.json            # 项目依赖和脚本配置
├── vite.config.js          # Vite 构建配置
├── README.md               # 项目说明文档
├── public/                 # 静态资源
├── src/
│   ├── main.js             # 应用入口
│   ├── App.vue             # 根组件
│   ├── style.css           # 全局样式
│   ├── assets/             # 资源文件
│   ├── components/         # 组件目录
│   └── stores/             # 状态管理
└── node_modules/           # 依赖包
```

### 状态管理

#### Auth Store (`src/stores/auth.js`)
管理用户认证状态：
- `isLoggedIn`: 登录状态
- `token`: JWT Token
- `user`: 用户信息
- `login()`: 登录方法
- `register()`: 注册方法
- `logout()`: 登出方法
- `loadFromStorage()`: 从本地存储恢复状态

### 开发脚本

```bash
# 开发服务器
npm run dev

# 生产构建
npm run build

# 预览构建
npm run preview
```

---

## API 接口

### 后端服务配置

**代理配置** (`vite.config.js`):
```javascript
server: {
  proxy: {
    "/react/chat": {
      target: "http://localhost:9081",
      changeOrigin: true,
    },
    "/api": {
      target: "http://localhost:9081",
      changeOrigin: true,
    },
  },
}
```

### 接口列表

| 接口 | 方法 | 描述 | 认证 |
|------|------|------|------|
| `/react/chat/stream` | GET (SSE) | 流式聊天接口 | 是 |
| `/api/auth/login` | POST | 用户登录 | 否 |
| `/api/auth/register` | POST | 用户注册 | 否 |
| `/api/auth/logout` | POST | 用户登出 | 是 |
| `/api/conversation/list` | GET | 获取历史对话列表 | 是 |
| `/api/conversation/{id}/messages` | GET | 获取对话消息 | 是 |
| `/api/conversation/{id}` | DELETE | 删除对话 | 是 |
| `/api/conversation` | POST | 创建新对话 | 是 |

### 聊天接口详情

#### 流式聊天接口

**端点**: `GET /react/chat/stream`

**请求头**:
```
Authorization: Bearer <token>
```

**查询参数**:
- `message`: 用户消息内容
- `conversationId`: 对话 ID（可选）

**响应**: Server-Sent Events 流

**事件类型**:
- `reasoning`: 推理过程
- `content`: 普通内容
- `tool_call`: 工具调用
- `done`: 完成信号
- `error`: 错误信息

**示例**:
```javascript
event: content
data: {"content": "这是一段回答"}

event: done
data: {"message": "完成"}
```

---

## 配置说明

### 环境变量

当前项目未配置环境变量文件，所有配置在代码中硬编码：

- **后端服务地址**: `http://localhost:9081`
- **API 前缀**: `/api`
- **聊天前缀**: `/react/chat`

### 本地开发

1. 确保后端服务运行在 `localhost:9081`
2. 安装依赖:
   ```bash
   npm install
   ```
3. 启动开发服务器:
   ```bash
   npm run dev
   ```
4. 访问 `http://localhost:5173`

### 生产部署

1. 构建项目:
   ```bash
   npm run build
   ```
2. 部署 `dist/` 目录到 Web 服务器
3. 配置反向代理到后端服务

---

## 功能使用指南

### 首次使用

1. 打开应用首页
2. 点击右上角登录按钮
3. 注册新账户或登录现有账户
4. 开始与 AI 助手对话

### 日常操作

#### 发送消息
1. 在底部输入框输入问题
2. 按 Enter 发送（Shift+Enter 换行）
3. 等待 AI 回复

#### 管理对话
- **新建对话**: 点击侧边栏"新建对话"按钮
- **查看历史**: 侧边栏自动显示历史对话列表
- **加载历史**: 点击历史对话项
- **删除对话**: 点击历史对话项的删除图标

#### 反馈消息
- 点击消息下方的 👍 或 👎 按钮进行反馈
- 点击复制图标复制消息内容

### 快捷键

| 快捷键 | 功能 |
|--------|------|
| Enter | 发送消息 |
| Shift + Enter | 换行 |

---

## 注意事项

1. **网络要求**: 需要连接到后端服务才能正常使用聊天功能
2. **浏览器兼容性**: 推荐使用 Chrome、Firefox、Edge 等现代浏览器
3. **存储空间**: 使用 localStorage 存储认证信息，浏览器隐私模式可能影响持久化
4. **流式响应**: 需要浏览器支持 EventSource API

---

## 更新日志

### v0.0.0
- 初始版本
- 实现基础聊天功能
- 支持用户认证
- 对话历史管理
- 流式消息响应

---

**文档生成时间**: 2026-02-10  
**项目路径**: `D:\Study\git\ai-study\finance-agent-frontend`
